<div class="modal-header" style="background: linear-gradient(135deg, #1a2a4c, #2c3e50); color: white;">
    <h5 class="modal-title fw-bold"><i class="fas fa-clipboard-list me-2"></i>{{ title }}</h5>
    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
</div>
<form method="post" class="modal-form">
    {% csrf_token %}
    <div class="modal-body" style="background-color: #f8f9fa; max-height: 70vh; overflow-y: auto;">
        <div class="text-center mb-4">
            <div class="patient-avatar mx-auto mb-3" style="width: 80px; height: 80px; font-size: 1.8rem; background: linear-gradient(135deg, #e74c3c, #c0392b);">
                {{ emergency.patient.first_name|first|upper }}
            </div>
            <h5 class="fw-bold">{{ emergency.patient.first_name }} {{ emergency.patient.last_name }}</h5>
            <p class="text-muted mb-0">{{ emergency.patient.date_of_birth|date:"d/m/Y" }} ({{ emergency.patient.gender }})</p>
        </div>
        
        <div class="row mb-3">
            <div class="col-md-6">
                <label for="triage_level" class="form-label fw-semibold text-dark">Niveau de triage</label>
                <select name="triage_level" id="triage_level" class="form-select" required>
                    <option value="">Sélectionnez un niveau</option>
                    <option value="LOW" {% if emergency.triage_level == 'LOW' %}selected{% endif %}>Léger (Vert)</option>
                    <option value="MEDIUM" {% if emergency.triage_level == 'MEDIUM' %}selected{% endif %}>Moyen (Jaune)</option>
                    <option value="HIGH" {% if emergency.triage_level == 'HIGH' %}selected{% endif %}>Grave (Rouge)</option>
                    <option value="CRITICAL" {% if emergency.triage_level == 'CRITICAL' %}selected{% endif %}>Vital (Noir)</option>
                </select>
            </div>
            <div class="col-md-6">
                <label for="doctor_id" class="form-label fw-semibold text-dark">Médecin responsable</label>
                <select name="doctor_id" id="doctor_id" class="form-select">
                    <option value="">Affecter un médecin</option>
                    {% for doctor in doctors %}
                    <option value="{{ doctor.id }}" 
                        {% if emergency.doctor and emergency.doctor.id == doctor.id %}selected{% endif %}>{{ doctor.get_full_name|default:doctor.username }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        
        <div class="row mb-3">
            <div class="col-md-12">
                <label for="vital_signs" class="form-label fw-semibold text-dark">Signes vitaux</label>
                <textarea name="vital_signs" id="vital_signs" class="form-control" rows="3" placeholder="Tension, température, pouls, saturation en O2, etc.">{% if emergency.vital_signs %}{{ emergency.vital_signs }}{% endif %}</textarea>
            </div>
        </div>
        
        <div class="row mb-3">
            <div class="col-md-12">
                <label for="first_aid" class="form-label fw-semibold text-dark">Premiers soins prodigués</label>
                <textarea name="first_aid" id="first_aid" class="form-control" rows="3" placeholder="Soins prodigués avant l'arrivée du médecin">{% if emergency.first_aid %}{{ emergency.first_aid }}{% endif %}</textarea>
            </div>
        </div>
        
        {% if user.profile.role == 'DOCTOR' %}
        <div class="row mb-3">
            <div class="col-md-12">
                <label for="initial_diagnosis" class="form-label fw-semibold text-dark">Diagnostic initial</label>
                <textarea name="initial_diagnosis" id="initial_diagnosis" class="form-control" rows="3" placeholder="Diagnostic préliminaire">{% if emergency.initial_diagnosis %}{{ emergency.initial_diagnosis }}{% endif %}</textarea>
            </div>
        </div>
        
        <div class="row mb-3">
            <div class="col-md-12">
                <label for="orientation" class="form-label fw-semibold text-dark">Orientation</label>
                <select name="orientation" id="orientation" class="form-select">
                    <option value="">Sélectionnez une orientation</option>
                    <option value="DISCHARGED" {% if emergency.orientation == 'DISCHARGED' %}selected{% endif %}>Sortie</option>
                    <option value="HOSPITALISED" {% if emergency.orientation == 'HOSPITALISED' %}selected{% endif %}>Hospitalisation</option>
                    <option value="TRANSFERRED" {% if emergency.orientation == 'TRANSFERRED' %}selected{% endif %}>Transfert</option>
                </select>
            </div>
        </div>
        {% endif %}
    </div>
    <div class="modal-footer bg-light" style="border-top: 1px solid #dee2e6;">
        <button type="button" class="btn btn-outline-secondary px-4" data-bs-dismiss="modal">Annuler</button>
        <button type="submit" class="btn btn-primary px-4 fw-semibold">
            <i class="fas fa-clipboard-check me-2"></i>Effectuer le triage
        </button>
    </div>
</form>

<script>
    // Ajouter des classes Bootstrap aux champs du formulaire si elles sont manquantes
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.modal-body input, .modal-body select, .modal-body textarea').forEach(function(element) {
            if (!element.classList.contains('form-control') && 
                !element.classList.contains('form-select') && 
                element.type !== 'hidden') {
                
                if (element.tagName === 'SELECT') {
                    element.classList.add('form-select');
                } else if (element.tagName === 'TEXTAREA') {
                    element.classList.add('form-control');
                } else {
                    element.classList.add('form-control');
                }
            }
        });
    });
</script>